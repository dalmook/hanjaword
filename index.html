<!doctype html>

<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>중국어 단어장 · 모바일</title>
  <style>
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Pretendard,sans-serif;background:#0b1020;color:#e6eefc}
    .wrap{max-width:820px;margin:0 auto;padding:16px 16px 96px}
    .btn{cursor:pointer;padding:8px 12px;border-radius:12px;border:1px solid #26325a;background:#1b2544;color:#e6eefc}
    .btn.acc{background:#4da3ff;color:#081123}
    .card{background:#12182b;padding:20px;border-radius:18px;min-height:220px;margin-top:14px}
    .hanzi{font-size:44px}
    .pinyin{font-size:18px;color:#cbd5e1;margin-top:6px}
    .meaning{margin-top:6px;font-size:16px}
    .example{margin-top:10px;font-size:15px}
    .mc button{display:block;width:100%;margin:6px 0;text-align:left}
  </style>
</head>
<body>
  <header class="wrap">
    <h1>중국어 단어장</h1>
    <div style="display:flex;gap:8px;flex-wrap:wrap">
      <input id="search" placeholder="검색 (한자/뜻)" />
      <select id="filterPos">
        <option value="">품사 전체</option>
        <option>명사</option>
        <option>동사</option>
        <option>형용사</option>
      </select>
      <select id="filterChap">
        <option value="">모든 챕터</option>
      </select>
      <button class="btn acc" id="addBtn">추가</button>
      <button class="btn" id="quizBtn">퀴즈</button>
      <button class="btn" id="syncBtn">구글 시트 동기화</button>
    </div>
  </header>  <main class="wrap">
    <section class="card" id="card">
      <div class="hanzi" id="hanzi">단어를 불러오세요</div>
      <div class="pinyin" id="pinyin"></div>
      <div class="meaning" id="meaning"></div>
      <div class="example" id="example"></div>
      <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
        <button class="btn" id="speakWord">🔊 단어 발음</button>
        <button class="btn" id="speakExample">🎧 예문 발음</button>
      </div>
    </section>
    <div style="margin-top:10px">
      <button class="btn" id="prevBtn">이전</button>
      <button class="btn" id="nextBtn">다음</button>
    </div>
  </main>  <!-- 퀴즈 모달 -->  <dialog id="quizModal">
    <div style="padding:16px">
      <h3>퀴즈 모드</h3>
      <p id="quizQuestion"></p>
      <div id="mcOptions" class="mc"></div>
      <div style="margin-top:10px">
        <button class="btn acc" id="quizNext">다음 문제</button>
        <button class="btn" onclick="quizModal.close()">닫기</button>
      </div>
      <p id="quizFeedback"></p>
    </div>
  </dialog>  <!-- 퀴즈 모드 선택 모달 -->  <dialog id="quizModeModal">
    <div style="padding:16px">
      <h3>퀴즈 모드 선택</h3>
      <p style="opacity:.8;margin:6px 0 10px">원하는 문제 유형을 선택하세요.</p>
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <button class="btn acc" id="modeH2M">한자 → 뜻 (4지선다)</button>
        <button class="btn" id="modeM2H">뜻 → 한자 (4지선다)</button>
      </div>
      <div style="margin-top:12px">
        <button class="btn" id="quizModeClose">닫기</button>
      </div>
    </div>
  </dialog>  <script>
    const LS_KEY = 'cn_vocab_cards_v2';
    let cards = JSON.parse(localStorage.getItem(LS_KEY)||'[]');
    if(cards.length===0){
      cards=[
        {hanzi:'学习',pinyin:'xuéxí',meaning:'공부하다',pos:'동사',example:'我喜欢学习中文。',example_ko:'나는 중국어 공부를 좋아해요',chapter:'chapter1'},
        {hanzi:'朋友',pinyin:'péngyou',meaning:'친구',pos:'명사',example:'他是我的好朋友。',example_ko:'그는 나의 좋은 친구예요',chapter:'chapter1'},
        {hanzi:'漂亮',pinyin:'piàoliang',meaning:'예쁘다',pos:'형용사',example:'这个城市很漂亮。',example_ko:'이 도시는 매우 예뻐요',chapter:'chapter2'}
      ];
    }
    let cursor=0;
    let quizMode=null;
    let quizCorrect='';

    function save(){ localStorage.setItem(LS_KEY, JSON.stringify(cards)); }
    function current(){ return cards[cursor]||null; }
    function render(){
      const c=current();
      if(!c){ hanzi.textContent='단어 없음'; pinyin.textContent=''; meaning.textContent=''; example.textContent=''; return; }
      hanzi.textContent=c.hanzi;
      pinyin.textContent=c.pinyin;
      meaning.textContent=c.meaning;
      example.textContent=c.example?`${c.example} (${c.example_ko||''})`:'';
    }
    function next(){ cursor=(cursor+1)%cards.length; render();

    // ====== 음성 합성(TTS) ======
    let voices=[];
    function loadVoices(){ try{ voices = window.speechSynthesis ? speechSynthesis.getVoices() : []; }catch(e){ voices=[]; } }
    if('speechSynthesis' in window){ loadVoices(); speechSynthesis.onvoiceschanged = loadVoices; }
    function pickZh(){
      return voices.find(v=>/zh|Chinese|Mandarin/i.test((v.lang||'')+v.name)) || voices[0] || null;
    }
    function speak(text){ if(!text || !('speechSynthesis' in window)) return;
      const u = new SpeechSynthesisUtterance(text);
      const v = pickZh(); if(v){ u.voice=v; u.lang=v.lang; } else { u.lang='zh-CN'; }
      u.rate = 1.0; u.pitch = 1.0;
      speechSynthesis.speak(u);
    }
    document.getElementById('speakWord').onclick=()=>{ const c=current(); if(c) speak(c.hanzi); };
    document.getElementById('speakExample').onclick=()=>{ const c=current(); if(c) speak(c.example || c.hanzi); };
 }
    function prev(){ cursor=(cursor-1+cards.length)%cards.length; render(); }

    // 구글 시트 동기화
    async function sync(){
      const EP_KEY='cn_vocab_endpoint';
      let url = localStorage.getItem(EP_KEY) || prompt('https://script.google.com/macros/s/AKfycbwpY0YKjzzr2KIfWIi8bcdNR4eJqyk8Hr2cRY4tt2MuIv8syI_wStRpnry0JVCwHp8f/exec');
      if(!url) return; localStorage.setItem(EP_KEY, url);
      try{
        const res = await fetch(url);
        const js = await res.json();
        const data = Array.isArray(js) ? js : (js && js.data ? js.data : []);
        if(Array.isArray(data)){
          cards = data;
          save(); cursor=0; render();
          alert('동기화 완료: '+cards.length+'개 항목');
        } else {
          alert('응답 형식을 확인하세요. data 배열이 없습니다.');
        }
      }catch(e){ alert('동기화 실패: '+e); }
    }
      }catch(e){ alert('동기화 실패:'+e); }
    }

    // 퀴즈
    function startQuiz(){
      // 명확한 모드 선택을 위해 별도 모달을 사용
      quizModeModal.showModal();
    }
    function stripSpaces(s){ return (s||'').replace(/\s+/g,''); }
    function nextQuiz(){
      const c=current(); if(!c) return;
      const fieldA=(quizMode==='hanzi2meaning')?'meaning':'hanzi';
      quizQuestion.textContent=(quizMode==='hanzi2meaning')?`이 단어의 뜻은 무엇일까요? → ${c.hanzi}`:`이 뜻에 해당하는 한자는 무엇일까요? → ${c.meaning}`;
      quizCorrect=c[fieldA]||'';
      const pool=cards.filter((x,i)=>i!==cursor).map(x=>x[fieldA]).filter(Boolean);
      for(let i=pool.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [pool[i],pool[j]]=[pool[j],pool[i]]; }
      const optsSet=new Set([quizCorrect]);
      for(const v of pool){ if(optsSet.size>=4) break; optsSet.add(v); }
      const opts=Array.from(optsSet);
      for(let i=opts.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [opts[i],opts[j]]=[opts[j],opts[i]]; }
      const cont=document.getElementById('mcOptions');
      cont.innerHTML='';
      opts.forEach(t=>{
        const b=document.createElement('button');
        b.className='btn';
        b.textContent=t;
        b.onclick=()=>{
          const ok=stripSpaces(t)===stripSpaces(quizCorrect);
          document.getElementById('quizFeedback').textContent= ok? '✅ 정답!':'❌ 오답. 정답: '+quizCorrect;
        };
        cont.appendChild(b);
      });
      document.getElementById('quizFeedback').textContent='';
    }

    document.getElementById('nextBtn').onclick=next;
    document.getElementById('prevBtn').onclick=prev;
    document.getElementById('syncBtn').onclick=sync;
    document.getElementById('quizBtn').onclick=startQuiz;
    document.getElementById('modeH2M').onclick=()=>{ quizMode='hanzi2meaning'; nextQuiz(); quizModeModal.close(); quizModal.showModal(); };
    document.getElementById('modeM2H').onclick=()=>{ quizMode='meaning2hanzi'; nextQuiz(); quizModeModal.close(); quizModal.showModal(); };
    document.getElementById('quizModeClose').onclick=()=>quizModeModal.close();
    document.getElementById('quizNext').onclick=()=>{ next(); nextQuiz(); };

    render();
  </script></body>
</html>
