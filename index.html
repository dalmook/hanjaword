<!doctype html>

<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>ì¤‘êµ­ì–´ ë‹¨ì–´ì¥ Â· ëª¨ë°”ì¼</title>
  <style>
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Pretendard,sans-serif;background:#0b1020;color:#e6eefc}
    .wrap{max-width:820px;margin:0 auto;padding:16px 16px 96px}
    .btn{cursor:pointer;padding:8px 12px;border-radius:12px;border:1px solid #26325a;background:#1b2544;color:#e6eefc}
    .btn.acc{background:#4da3ff;color:#081123}
    .card{background:#12182b;padding:20px;border-radius:18px;min-height:220px;margin-top:14px}
    .hanzi{font-size:44px}
    .pinyin{font-size:18px;color:#cbd5e1;margin-top:6px}
    .meaning{margin-top:6px;font-size:16px}
    .example{margin-top:10px;font-size:15px}
    .mc button{display:block;width:100%;margin:6px 0;text-align:left}
  </style>
</head>
<body>
  <header class="wrap">
    <h1>ì¤‘êµ­ì–´ ë‹¨ì–´ì¥</h1>
    <div style="display:flex;gap:8px;flex-wrap:wrap">
      <input id="search" placeholder="ê²€ìƒ‰ (í•œì/ëœ»)" />
      <select id="filterPos">
        <option value="">í’ˆì‚¬ ì „ì²´</option>
        <option>ëª…ì‚¬</option>
        <option>ë™ì‚¬</option>
        <option>í˜•ìš©ì‚¬</option>
      </select>
      <select id="filterChap">
        <option value="">ëª¨ë“  ì±•í„°</option>
      </select>
      <button class="btn acc" id="addBtn">ì¶”ê°€</button>
      <button class="btn" id="quizBtn">í€´ì¦ˆ</button>
      <button class="btn" id="syncBtn">êµ¬ê¸€ ì‹œíŠ¸ ë™ê¸°í™”</button>
    </div>
  </header>  <main class="wrap">
    <section class="card" id="card">
      <div class="hanzi" id="hanzi">ë‹¨ì–´ë¥¼ ë¶ˆëŸ¬ì˜¤ì„¸ìš”</div>
      <div class="pinyin" id="pinyin"></div>
      <div class="meaning" id="meaning"></div>
      <div class="example" id="example"></div>
      <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
        <button class="btn" id="speakWord">ğŸ”Š ë‹¨ì–´ ë°œìŒ</button>
        <button class="btn" id="speakExample">ğŸ§ ì˜ˆë¬¸ ë°œìŒ</button>
      </div>
    </section>
    <div style="margin-top:10px">
      <button class="btn" id="prevBtn">ì´ì „</button>
      <button class="btn" id="nextBtn">ë‹¤ìŒ</button>
    </div>
  </main>  <!-- í€´ì¦ˆ ëª¨ë‹¬ -->  <dialog id="quizModal">
    <div style="padding:16px">
      <h3>í€´ì¦ˆ ëª¨ë“œ</h3>
      <p id="quizQuestion"></p>
      <div id="mcOptions" class="mc"></div>
      <div style="margin-top:10px">
        <button class="btn acc" id="quizNext">ë‹¤ìŒ ë¬¸ì œ</button>
        <button class="btn" onclick="quizModal.close()">ë‹«ê¸°</button>
      </div>
      <p id="quizFeedback"></p>
    </div>
  </dialog>  <!-- í€´ì¦ˆ ëª¨ë“œ ì„ íƒ ëª¨ë‹¬ -->  <dialog id="quizModeModal">
    <div style="padding:16px">
      <h3>í€´ì¦ˆ ëª¨ë“œ ì„ íƒ</h3>
      <p style="opacity:.8;margin:6px 0 10px">ì›í•˜ëŠ” ë¬¸ì œ ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”.</p>
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <button class="btn acc" id="modeH2M">í•œì â†’ ëœ» (4ì§€ì„ ë‹¤)</button>
        <button class="btn" id="modeM2H">ëœ» â†’ í•œì (4ì§€ì„ ë‹¤)</button>
      </div>
      <div style="margin-top:12px">
        <button class="btn" id="quizModeClose">ë‹«ê¸°</button>
      </div>
    </div>
  </dialog>  <script>
    const LS_KEY = 'cn_vocab_cards_v2';
    let cards = JSON.parse(localStorage.getItem(LS_KEY)||'[]');
    if(cards.length===0){
      cards=[
        {hanzi:'å­¦ä¹ ',pinyin:'xuÃ©xÃ­',meaning:'ê³µë¶€í•˜ë‹¤',pos:'ë™ì‚¬',example:'æˆ‘å–œæ¬¢å­¦ä¹ ä¸­æ–‡ã€‚',example_ko:'ë‚˜ëŠ” ì¤‘êµ­ì–´ ê³µë¶€ë¥¼ ì¢‹ì•„í•´ìš”',chapter:'chapter1'},
        {hanzi:'æœ‹å‹',pinyin:'pÃ©ngyou',meaning:'ì¹œêµ¬',pos:'ëª…ì‚¬',example:'ä»–æ˜¯æˆ‘çš„å¥½æœ‹å‹ã€‚',example_ko:'ê·¸ëŠ” ë‚˜ì˜ ì¢‹ì€ ì¹œêµ¬ì˜ˆìš”',chapter:'chapter1'},
        {hanzi:'æ¼‚äº®',pinyin:'piÃ oliang',meaning:'ì˜ˆì˜ë‹¤',pos:'í˜•ìš©ì‚¬',example:'è¿™ä¸ªåŸå¸‚å¾ˆæ¼‚äº®ã€‚',example_ko:'ì´ ë„ì‹œëŠ” ë§¤ìš° ì˜ˆë»ìš”',chapter:'chapter2'}
      ];
    }
    let cursor=0;
    let quizMode=null;
    let quizCorrect='';

    function save(){ localStorage.setItem(LS_KEY, JSON.stringify(cards)); }
    function current(){ return cards[cursor]||null; }
    function render(){
      const c=current();
      if(!c){ hanzi.textContent='ë‹¨ì–´ ì—†ìŒ'; pinyin.textContent=''; meaning.textContent=''; example.textContent=''; return; }
      hanzi.textContent=c.hanzi;
      pinyin.textContent=c.pinyin;
      meaning.textContent=c.meaning;
      example.textContent=c.example?`${c.example} (${c.example_ko||''})`:'';
    }
    function next(){ cursor=(cursor+1)%cards.length; render();

    // ====== ìŒì„± í•©ì„±(TTS) ======
    let voices=[];
    function loadVoices(){ try{ voices = window.speechSynthesis ? speechSynthesis.getVoices() : []; }catch(e){ voices=[]; } }
    if('speechSynthesis' in window){ loadVoices(); speechSynthesis.onvoiceschanged = loadVoices; }
    function pickZh(){
      return voices.find(v=>/zh|Chinese|Mandarin/i.test((v.lang||'')+v.name)) || voices[0] || null;
    }
    function speak(text){ if(!text || !('speechSynthesis' in window)) return;
      const u = new SpeechSynthesisUtterance(text);
      const v = pickZh(); if(v){ u.voice=v; u.lang=v.lang; } else { u.lang='zh-CN'; }
      u.rate = 1.0; u.pitch = 1.0;
      speechSynthesis.speak(u);
    }
    document.getElementById('speakWord').onclick=()=>{ const c=current(); if(c) speak(c.hanzi); };
    document.getElementById('speakExample').onclick=()=>{ const c=current(); if(c) speak(c.example || c.hanzi); };
 }
    function prev(){ cursor=(cursor-1+cards.length)%cards.length; render(); }

    // êµ¬ê¸€ ì‹œíŠ¸ ë™ê¸°í™”
    async function sync(){
      const EP_KEY='cn_vocab_endpoint';
      let url = localStorage.getItem(EP_KEY) || prompt('https://script.google.com/macros/s/AKfycbwpY0YKjzzr2KIfWIi8bcdNR4eJqyk8Hr2cRY4tt2MuIv8syI_wStRpnry0JVCwHp8f/exec');
      if(!url) return; localStorage.setItem(EP_KEY, url);
      try{
        const res = await fetch(url);
        const js = await res.json();
        const data = Array.isArray(js) ? js : (js && js.data ? js.data : []);
        if(Array.isArray(data)){
          cards = data;
          save(); cursor=0; render();
          alert('ë™ê¸°í™” ì™„ë£Œ: '+cards.length+'ê°œ í•­ëª©');
        } else {
          alert('ì‘ë‹µ í˜•ì‹ì„ í™•ì¸í•˜ì„¸ìš”. data ë°°ì—´ì´ ì—†ìŠµë‹ˆë‹¤.');
        }
      }catch(e){ alert('ë™ê¸°í™” ì‹¤íŒ¨: '+e); }
    }
      }catch(e){ alert('ë™ê¸°í™” ì‹¤íŒ¨:'+e); }
    }

    // í€´ì¦ˆ
    function startQuiz(){
      // ëª…í™•í•œ ëª¨ë“œ ì„ íƒì„ ìœ„í•´ ë³„ë„ ëª¨ë‹¬ì„ ì‚¬ìš©
      quizModeModal.showModal();
    }
    function stripSpaces(s){ return (s||'').replace(/\s+/g,''); }
    function nextQuiz(){
      const c=current(); if(!c) return;
      const fieldA=(quizMode==='hanzi2meaning')?'meaning':'hanzi';
      quizQuestion.textContent=(quizMode==='hanzi2meaning')?`ì´ ë‹¨ì–´ì˜ ëœ»ì€ ë¬´ì—‡ì¼ê¹Œìš”? â†’ ${c.hanzi}`:`ì´ ëœ»ì— í•´ë‹¹í•˜ëŠ” í•œìëŠ” ë¬´ì—‡ì¼ê¹Œìš”? â†’ ${c.meaning}`;
      quizCorrect=c[fieldA]||'';
      const pool=cards.filter((x,i)=>i!==cursor).map(x=>x[fieldA]).filter(Boolean);
      for(let i=pool.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [pool[i],pool[j]]=[pool[j],pool[i]]; }
      const optsSet=new Set([quizCorrect]);
      for(const v of pool){ if(optsSet.size>=4) break; optsSet.add(v); }
      const opts=Array.from(optsSet);
      for(let i=opts.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [opts[i],opts[j]]=[opts[j],opts[i]]; }
      const cont=document.getElementById('mcOptions');
      cont.innerHTML='';
      opts.forEach(t=>{
        const b=document.createElement('button');
        b.className='btn';
        b.textContent=t;
        b.onclick=()=>{
          const ok=stripSpaces(t)===stripSpaces(quizCorrect);
          document.getElementById('quizFeedback').textContent= ok? 'âœ… ì •ë‹µ!':'âŒ ì˜¤ë‹µ. ì •ë‹µ: '+quizCorrect;
        };
        cont.appendChild(b);
      });
      document.getElementById('quizFeedback').textContent='';
    }

    document.getElementById('nextBtn').onclick=next;
    document.getElementById('prevBtn').onclick=prev;
    document.getElementById('syncBtn').onclick=sync;
    document.getElementById('quizBtn').onclick=startQuiz;
    document.getElementById('modeH2M').onclick=()=>{ quizMode='hanzi2meaning'; nextQuiz(); quizModeModal.close(); quizModal.showModal(); };
    document.getElementById('modeM2H').onclick=()=>{ quizMode='meaning2hanzi'; nextQuiz(); quizModeModal.close(); quizModal.showModal(); };
    document.getElementById('quizModeClose').onclick=()=>quizModeModal.close();
    document.getElementById('quizNext').onclick=()=>{ next(); nextQuiz(); };

    render();
  </script></body>
</html>
